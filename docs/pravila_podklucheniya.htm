<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
                <title>Руководство по подключению</title>
                <style type="text/css">
    body {
        font-family: "Trebuchet MS", Skia, "Lucida Sans Unicode", sans-serif;
        margin:  20 40;
        background-color: #ffffff;
        align: justify
    }    
    pre {
        font-family: "Courier New" Courier monospace; 
        font-size:11.0pt;
        color: red;
        padding: 15px 10px;
        margin: 0 5ex 1.5em 5ex;
        /*
        background-color: white;
        border-width: 1px; 
        border-style: solid;
        border-color: gray;
        */
    }
    table {
        border: 1px solid #666666;
        width:100%px;
        border-collapse: collapse;
    }
    th { 
        border: 1px solid #666666;
        vertical-align: top;
        text-align: center;
    }
    td { 
        border: 1px solid #666666;
        vertical-align: top;
        padding: 2px 5px 2px 5px;
    }
    h1,h2,h3,h4 {
        font-size:16.0pt;
        padding: 15px;
    }
    p, li, td, th {
        font-size:11.0pt;
    }
#fixme { position: absolute; left: 5px; top: 5px; width: 120px; height: 23px; overflow:hidden;border: none;}
div > div#fixme { position: fixed; }
#fixmetoo { position: absolute; left: 5px; top: 5px; width: 500px; height: 500px; overflow:scroll;border: thin solid black; }
div > div#fixmetoo { position: fixed; }
                </style><!--[if gte IE 5.5]><![if lt IE 7]>
                <style type="text/css">
div#fixme {
left: expression( ( 0 + ( ignoreMe2 = document.documentElement.scrollLeft ? document.documentElement.scrollLeft : document.body.scrollLeft ) ) + 'px' );
top: expression( ( 0 + ( ignoreMe = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop ) ) + 'px' );
}
div#fixmetoo {
right: auto; bottom: auto;
left: expression( ( 0 - fixmetoo.offsetWidth + ( document.documentElement.clientWidth ? document.documentElement.clientWidth : document.body.clientWidth ) + ( ignoreMe2 = document.documentElement.scrollLeft ? document.documentElement.scrollLeft : document.body.scrollLeft ) ) + 'px' );
top: expression( ( 0 - fixmetoo.offsetHeight + ( document.documentElement.clientHeight ? document.documentElement.clientHeight : document.body.clientHeight ) + ( ignoreMe = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop ) ) + 'px' );
}
                </style>
                <![endif]><![endif]-->

<script language="JavaScript">
    var isOpen='0';
    function svernut(){
        if(isOpen=='0'){
            isOpen='1';
            document.getElementById('but1').value="Свернуть оглавление";
            document.getElementById('fixme').style.width='500px';
            document.getElementById('fixme').style.height='300px';
            document.getElementById('fixme').style.top='200px';
            document.getElementById('fixme').style.overflow='scroll';
            document.getElementById('fixme').style.border='thin solid black';
        }else{
            isOpen='0';
            document.getElementById('but1').value="Оглавление";
            document.getElementById('fixme').style.width='120px';
            document.getElementById('fixme').style.height='23px';
            document.getElementById('fixme').style.top='5px';
            document.getElementById('fixme').style.overflow='hidden';
            document.getElementById('fixme').style.border='none';
        }
    }
</script>


        </head>
        <body>




<div id="content" style="width: 100%">
<br>
<p style="font-size: 18.0pt;"><b>Руководство по подключению, интеграции и использованию Платежной Системы РБС.</b></p>
<p><b>Редакция: 2009-07-20; v4.1</b></p>
<hr><br>

<a name="1."><h1>1. Основные термины и определения.</h1></a>
<table>
    <tbody><tr>
        <th>Термин</th>
        <th>Описание</th>
    </tr>
    <tr>
        <td>Магазин</td>
        <td>Торгово-Сервисное Предприятие, продающее товары или оказывающее услуги через интернет-сайт.</td>
    </tr>
    <tr>
        <td>Клиент или Покупатель</td>
        <td>Клиент Торгово-Сервисного Предприятия, желающий осуществить оплату за приобретаемые на сайте магазина товары или услуги.</td>
    </tr>
    <tr>
        <td>Карта или Пластиковая карта</td>
        <td>Пластиковая карта международных платежных систем VISA и 
MasterCard, выданная Клиенту Магазина в его "родном" банке (Банке 
эмитенте)
        для операций со средствами, хранящимися на счете Клиента 
Магазина, "привязанном" к данной карте.</td>
    </tr>
    <tr>
        <td>Банк-эмитент</td>
        <td>Банк, в котором у Клиента Магазина открыт счет, с которого осуществляется платеж, и к которому "привязана" пластиковая карта.</td>
    </tr>
    <tr>
        <td>Банк-эквайер</td>
        <td>Банк, осуществляющий операции(снятие, возврат и т.д.) со 
средствами на карте Клиента в пользу Магазина. Банк-эквайер 
взаимодействует с Банком-эмитентом через платежные системы(Visa, 
MasterCard и тд). В случае Системы РБС - Банком-эквайером является 
Альфа-Банк.</td>
    </tr>
    <tr>
        <td>Система РБС</td>
        <td>Платежная система РБС является одной из услуг Банка-эквайера
 и обеспечивает функциональность для Магазина
        по приему платежей через интернет с использованием Пластиковых 
карт (международных платежных систем VISA и MasterCard) покупателей.</td>
    </tr>
</tbody></table>

<a name="2."><h1>2. Возможности Системы РБС.</h1></a>

<a name="2.1."><h2>2.1. Поддерживаемые платежи и механизмы аутентификации.</h2></a>

<p>Система поддерживает два типа платежа:</p>
<ul>
    <li><b>Одностадийный платеж</b> - это платеж, при котором вся сумма платежа сразу списывается со счета покупателя.</li>
    <li><b>Двухстадийный платеж</b> - это платеж, при котором деньги на первой стадии блокируются на счете покупателя, а на второй стадии списываются.</li>
</ul>
<p>Также средствами системы возможно осуществлять платежи по протоколу <b>3D-Secure/SecureCode.</b>
Механизм аутентификации Пользователя через данные протоколы основан на 
использовании для аутентификации дополнительных данных о Пользователе, 
на
другом сервере и доставленные через другие каналы данных.</p>
<p><i><u>Примечание</u>: К примеру, пользователь может получить пароль 
дополнительной аутентификации через SMS
полученный от банка на сотовый телефон известный Банку-Эмитенту и 
использовать его на сервере аутентификации Банка-эмитента. Таким образом
понижается вероятность фрода (fraud), снижаются финансовые риски.</i></p>

<a name="2.2."><h2>2.2. Функциональные возможности системы.</h2></a>

<p>Пользователю Системы РБС (Магазину) предоставляются следующие возможности по работе с платежами:</p>
<ul>
    <li>Прием одностадийного или двухстадийного платежа.</li>
    <li>Завершение двухстадийного платежа.</li>
    <li>Отмена отложенной авторизации двухстадийного платежа. Снятие блокировки средств на счету Покупателя.</li>
    <li>Отмена одностадийного или двухстадийного платежа.</li>
<i><u>Примечание</u>: По стандартному договору между интернет магазином и
 Альфа Банком отмена через web-интерфейс одностадийного платежа 
невозможна. Для отмены таких платежей нужно отправить электронное письмо
 установленной формы на соответствующий адрес Альфа Банка. Форма письма и
 адрес указаны в договоре.</i>
    <li>Запрос состояния платежа.</li>
    <li>Возврат средств на карту.</li>
<i><u>Примечание</u>: По стандартному договору между интернет магазином и Альфа Банком возврат денег на карту невозможен.</i>
    <li>Пакетное завершение множества двухстадийных платежей.</li>
    <li>Просмотр, поиск и выгрузка данных по операциям в виде отчетов.</li>
</ul>

<a name="2.3."><h2>2.3. Страница оплаты.</h2></a>

<p>При вводе данных карты на стороне Системы РБС форма ввода данных о 
Покупателе и его Пластиковой карте расположена на сайте Системы РБС.</p>
<p><i><u>Примечание</u>: <a href="https://www.paymentgate.ru/bpcservlet/BPC/Connection.jsp">при желании пользователя, может быть оформлена в соответствии с дизайном Магазина.</a></i></p>


<a name="3."><h1>3. Описание процессов приема платежей.</h1></a>

<a name="3.1."><h2>3.1. Прием платежа на стороне Системы РБС.</h2></a>

<p>Покупатель, зайдя на сайт магазина и выбрав набор товаров или услуг, решает расплатиться за них пластиковой карточкой.</p>
<p>В данной ситуации сайт Магазина обычно показывает Покупателю страницу заказа похожую по стилю оформления на
классический бумажный счет с кнопкой "оплатить", нажав которую Покупатель по защищенному HTTPS/SSL2-3 
каналу, попадает на страницу, на которой вводит данные о своей Пластиковой карте.</p>
<p>При работе с Системой РБС возможны два способа реализации данной безопасной страницы:</p>
<ul>
    <li>Безопасная страница выполнена на площадке Системы РБС.</li> 
    <i><u>Примечание</u>: В практике электронной коммерции принято 
считать хорошим тоном когда рядом с кнопкой сайта 
    "оплатить" покупателю каким-либо образом объясняют дальнейшие 
действия: "сейчас вы будете переведены на 
    защищенную страницу расположенную на сайте Системы РБС, где 
безопасно осуществите свой платеж и будете возвращены обратно на сайт
    нашего магазина"</i><br>
    Дизайн страницы ввода параметров банковской карты индивидуален для 
каждого магазина. О размещении данной страницы на сайте РБС подробнее 
    смотрите в разделе: (тут надо ссылку на нужный раздел дать)
    <li>Существует возможность реализовать безопасную страницу для ввода данных карты на стороне сайта магазина.</li>
    <i><u>Примечание</u>: Данная возможность требует дополнительного согласования с Альфа Банком.</i>
</ul>
<p><img src="pravila_podklucheniya_files/image002.jpg" alt="Рисунок 1."></p>
<p><b>Рисунок 1.</b></p>

<p>Введенные Покупателем данные карты передаются через банковские сети в
 Банк-эмитент, где принимается решение о списании (или
блокировке) средств со счета Покупателя. Информация о данном решении 
передается обратно в Систему РБС, где транслируется в информационное 
сообщение и
передается обратно сайту магазина.</p>

<p>Сайт магазина обрабатывает данное сообщение и на его основе принимает решение об оказании услуг или отгрузке товара покупателю.</p>
<p>Как показано на <b><i>рис.1,</i></b> механизм переадресации покупателя с сайта магазина на страницу ввода данных
карты и обратно осуществляется следующим образом:</p>
<ol>
    <li>Предварительно магазин регистрирует заказ покупателя в Системе 
РБС, передавая данные о заказе и URL для возврата в пп.4 по защищенному 
HTTPS/SSL2-3 каналу.</li>
    <li>В ответ Система РБС по защищенному HTTPS/SSL2-3 каналу передает 
информационное сообщение обратно сайту Магазина, в котором содержится 
уникальный идентификатор, присвоенный данному заказу.</li>
    <li>Магазин показывает клиенту страницу с кнопкой или ссылкой, после
 нажатия на которую браузер покупателя перенаправляется на защищенную 
страницу ввода параметров банковской карты расположенную на сайте 
Системы РБС. В адресе перенаправления содержится уникальный 
идентификатор заказа, полученный в предыдущем шаге (пп.3).</li>
    <li>Покупатель вводит свою карту и, после завершения оплаты, 
перенаправляется обратно на сайт Магазина на URL указанный в пункте 1, 
передавая по защищенному HTTPS/SSL2-3 каналу данные о результате оплаты.</li>
</ol>

<a name="3.2."><h2>3.2. Взаимодействие при размещении страницы оплаты на стороне Магазина.</h2></a>

<p><img src="pravila_podklucheniya_files/image003.gif" alt="Рисунок 2."></p>
<p><b>Рисунок 2.</b></p>
<p>При реализации приема платежей на стороне Магазина пользователь, попав на страницу оплаты, вводит данные своей карты.</p>
<p>Данные передаются на сервер Магазина по защищенному HTTPS/SSL2-3 каналу (рис.2 пп.1).</p>
<p>Магазин открывает HTTPS/SSL2-3 соединение с сервером Системы РБС и 
передает ей данные полученные от пользователя, информацию о заказе и 
регистрационные данные самого Магазина (рис.2 пп.2).</p>
<p>В ответ, по защищенному HTTPS/SSL2-3 каналу, Система РБС возвращает 
уникальный номер идентифицирующий данный платеж и результат 
осуществления операции по оплате (рис.2 пп.3).</p>

<a name="3.3."><h2>3.3. Прием платежа для карты 3D-Secure/SecureCode на стороне магазина.</h2></a>

<p><img src="pravila_podklucheniya_files/image005.jpg" alt="Рисунок 3."></p>
<p><b>Рисунок 3.</b></p>
<p>В случае, когда для карты Покупателя Магазина Банк-эмитент назначил 
аутентификацию через протоколы 3D-Secure/SecureCode, Система РБС 
возвращает Магазину расширенный ответ (рис.3 пп.3), на основании 
которого, Магазин понимает, что данная карта использует механизм 
аутентификации по 3D-Secure/SecureCode.</p>
<p>В расширенном ответе содержится URL на специально созданную страницу 
сервера аутентификации Банка-Эмитента и Покупателя необходимо 
перенаправить дальше по этой URL через http-redirect (рис.3 пп.4).</p>
<p>По окончании аутентификации на сервере Банка-Эмитента, Покупатель 
будет возвращен на сайт Магазина через HTTP-REDIRECT
с информацией о результате аутентификации Банком-Эмитентом. Данная 
информации будет передана в http параметрах через HTTP-REDIRECT (рис.3 
пп.5).</p>
<p>Получив данные от Банка-Эмитента, Сайт Магазина должен через 
HTTP-запрос по защищенному каналу HTTPS/SSL2-3 уведомить Систему РБС о 
результатах
аутентификации Банком-Эквайером (рис.3 пп.6). В ответ от Системы РБС 
Магазин получит результат проведения платежа (рис.3 пп.7)</p>

<a name="4."><h1>4. Техническое описание функциональных возможностей Системы РБС.</h1></a>

<a name="4.1."><h2>4.1. Прием одностадийного или двухстадийного платежа.</h2></a>

<p> Состоит из двух этапов:</p>
<ul>
    <li>Регистрация заказа на сайте Системы РБС.</li>
    <li>Оплата через сайт Системы РБС</li>
</ul>

<a name="4.1.1."><h3>4.1.1. Регистрация заказа (одностадийный или двухстадийный платеж).</h3></a>

<p>Состоит из запроса на регистрацию и ответа от Системы РБС сайту Магазина.</p>

<a name="4.1.1.1."><h4>4.1.1.1. Запрос на регистрацию заказа (одностадийный или двухстадийный платеж).</h4></a>

<p>Магазин регистрирует свой заказ на сервере РБС, передавая методом GET или POST HTTPS запрос с параметрами платежа по адресу:</p>

<pre>https://playground.paymentgate.ru/bpcservlet/Merchant2Rbs
</pre>

<p>playground.paymentgate.ru - IP-адрес тестового сервера,<br> engine.paymentgate.ru - "рабочий" сервер</p>

<p>Обмен данными между сайтом магазина и сервером Системой РБС идет по протоколу HTTPS. SSL шифрование стандарта
2 и 3 защищает данные от прослушивания и изменения. Идентификация Магазина при
регистрации заказа происходит по идентификационному номеру и паролю, выданным при
регистрации Магазина на сайте Системы РБС.</p>
<p><i><u>Примечание</u>:
</i></p><ol><i>
    <li>При формировании запроса ВСЕ ИМЕНА ПАРАМЕТРОВ ЧУВСТВИТЕЛЬНЫ К РЕГИСТРУ И ДОЛЖНЫ БЫТЬ НАБРАНЫ ЗАГЛАВНЫМИ БУКВАМИ.</li>
    <li>При подстановке параметров в HTTP-запрос значения необходимо кодировать в соответствии со стандартами w3c.org</li>
</i></ol><i>
</i><p></p>
<p>Параметры запроса:</p>

<table>
    <tbody><tr>
        <th>Название параметра</th>
        <th>Тип и формат данных</th>
        <th>Обязательный параметр для платежа с сайта РБС</th>
        <th>Обязательный параметр для платежа с сайта Магазина</th>
        <th>Описание</th>
    </tr>
    <tr>
        <td>MERCHANTNUMBER</td>
        <td>Строка десятичных цифр</td>
        <td>Да</td>
        <td>Да</td>
        <td>Номер Магазина выдаваемый при регистрации данного Магазина на сервере Системы РБС. <br>Пример: <pre>118600118604000118605</pre></td>
    </tr>
    <tr>
        <td>ORDERNUMBER</td>
        <td>Целое десятичное число.<br>В диапазоне от 1 до 999999999</td>
        <td>Да</td>
        <td>Да</td>
        <td>Внутренний идентификационный номер заказа в информационной системе сайта Магазина.</td>
    </tr>
    <tr>
        <td>AMOUNT</td>
        <td>Целое десятичное число. Не меньше 100.</td>
        <td>Да</td>
        <td>Да</td>
        <td>Значение суммы платежа в копейках.<br>Например, 4378, что соответствует сумме 43 рубля 78 копеек.</td>
    </tr>
    <tr>
        <td>BACKURL</td>
        <td>URL-строка<p></p>
        <p><b>C указанием префикса http:// или https://</b></p></td>
        <td>Да</td>
        <td>Да</td>
        <td>Адрес на сервере Магазина для приема результатов проведения платежа. <br>
            <i><u>Примечание</u>: При подстановке значения параметра в запрос на регистрацию строку URL необходимо кодировать 
            в соответствии со стандартами w3c.org (URI-encoded)</i> 
            <br><br>
            Пример:<pre>https://www.shop.ru/AuthResult.cgi?<br>param1=1&amp;param2=2</pre>
            Пример закодированного значения:
            <pre>https%3A%2F%2Fwww.shop.ru%2FAuthResult.cgi<br>%3Fparam1%3D1</pre></td>
    </tr>
    <tr>
        <td>$ORDERDESCRIPTION</td>
        <td>Строка до 350 символов</td>
        <td>Да</td>
        <td>Да</td>
        <td>Краткое описание заказа<br> Пример: <pre>оплата заказа номер 123</pre></td>
    </tr>
    <tr>
        <td>LANGUAGE</td>
        <td>Строка из двух латинских символов в верхнем регистре<br> допустимые значения: RU или EN</td>
        <td>Да</td>
        <td>Да</td>
        <td>Язык страницы ввода параметров пластиковой карты</td>
    </tr>
    <tr>
        <td>DEPOSITFLAG</td>
        <td>Целое десятичное число. <br>Возможные значения: 0 или 1</td>
        <td>Да</td>
        <td>Да</td>
        <td>Флаг, отвечающий за автоматический перевод суммы заказа (одностадийный или двухстадийный платеж)<br> <b>DEPOSITFLAG</b> = 0 - сумма блокируется на счету клиента, 
        но не переводится на счет Магазина. Перевод денег откладывается до момента операции "Завершение". <br><i><u>Примечание</u>: Порядок проведения операции 
        завершение описан в пункте "4.4.2. Проведение отложенной авторизации".</i> <br><b>DEPOSITFLAG</b> = 1 - сумма переводится на счет Магазина.</td>
    </tr>
    <tr>
        <td>MERCHANTPASSWD</td>
        <td>Строка</td>
        <td>Да</td>
        <td>Да</td>
        <td>Пароль для идентификации Магазина.</td>
    </tr>
    <tr>
        <td>PAN_MKO</td>
        <td>Число</td>
        <td>НЕТ</td>
        <td>ДА</td>
        <td>Номер карты <br><i><u>Примечание</u>: Используется на странице оплаты выполненной на стороне Магазина.</i></td>
    </tr>
    <tr>
        <td>CVC_MKO</td>
        <td>Число</td>
        <td>НЕТ</td>
        <td>ДА</td>
        <td>CVC2/CVV2 код карты <br><i><u>Примечание</u>: Используется на странице оплаты выполненной на стороне Магазина.</i></td>
    </tr>
    <tr>
        <td>EXP_MKO</td>
        <td>Строка <br>Формат:YYYYMM</td>
        <td>НЕТ</td>
        <td>ДА</td>
        <td>Срок действия карты. <br><i><u>Примечание</u>: Используется на странице оплаты выполненной на стороне Магазина.</i></td>
    </tr>
    <tr>
        <td>CARDHOLDER_MKO</td>
        <td>Строка</td>
        <td>НЕТ</td>
        <td>ДА</td>
        <td>Имя держателя карты. <br><i><u>Примечание</u>: Используется на странице оплаты выполненной на стороне Магазина.</i></td>
    </tr>
    <!-- tr>
        <td>LOGIN</td>
        <td>Строка</td>
        <td>НЕТ</td>
        <td>НЕТ</td>
        <td>Пароль на авторизацию. Используется для дополнительной аутентификации Клиента после перехода с сайта Магазина на страницу ввода
        данных Пластиковой карты расположенную на сайте Системы РБС. После перехода на страницу ввода данных 
        Пластиковой карты, Клиенту будет предложено ввести известное только ему и Магазину значение, например, номер счета клиента в 
        Магазине. При совпадении введенного значения с параметром <b>LOGIN</b> клиент может произвести платеж, при несовпадении платеж отклоняется. 
        <br>Дополнительная проверка клиента требуется для Магазинов предоставляющих виртуальные услуги. <br><br>Параметр необязательный.</td>
    </tr -->
    <tr>
        <td>USER_IP</td>
        <td>Строка</td>
        <td>НЕТ</td>
        <td>НЕТ</td>
        <td>Данный параметр содержит IP-адрес покупателя.</td>
    </tr>
    <tr>
        <td>CHARSET</td>
        <td>Строка</td>
        <td>НЕТ</td>
        <td>НЕТ</td>
        <td>Необязательный параметр со значением по умолчанию windows-1251
                Определяет кодировку значения параметра $ORDERDESCRIPTION
                Также может принимать значения UTF-8, KOI8-R, UTF-16, ISO-8859-1, US-ASCII.
                </td>
    </tr>
    <tr>
        <td>MODE</td>
        <td>Целое число</td>
        <td>НЕТ</td>
        <td>Не используется</td>
        <td>Определяет формат ответа от Сервера РБС <br>Если <b>MODE</b>=1, то возвращается текстовая строка <br>Если <b>MODE</b>=2 ,то возвращается XML-документ 
        <br>Если <b>MODE</b> не указан или имеет любое другое значение отличное от 1 и 2, то тогда возвращается фрагмент HTML</td>
    </tr>
</tbody></table>

<p><i><u>Примечание</u></i><i>: Параметры <b>PAN_MKO, CVC_MKO, EXP_MKO, CARDHOLDER_MKO</b>
 используются только в том
случае если по соглашению с Альфа-банком достигнута договоренность о 
том, что Магазин принимает данные карты со своего сайта. На основании 
данного соглашения
администратор Системы РБС внес отметку в регистрационные данные Магазина
 такой возможности.</i></p>

<p>В случае, когда данные о платеже по карте Клиента были
введены на странице расположенной на стороне сайта Магазина, запрос с данными
браузер Клиента передает на сайта Магазина, откуда программное обеспечение сайта посылает HTTPS запрос и
пересылает полученные данные в Систему РБС. В ответ Система РБС возвращает
сайту Магазина результат с ответом о прохождении запроса платежа. При такой
схеме взаимодействия параметр <b>BACKURL</b> не используется. Описание формата
ответа в разделе "Ответ на запрос платежа с данными карты собранными на
стороне магазина".</p>
<p>Рассмотрим подробнее параметр <b>BACKURL</b>.
Как было сказано выше, он содержит адрес на страницы на сайте Магазина для
приема результатов проведения платежа. Адрес BACKURL может содержать
произвольное число дополнительных параметров, 
например, www.shop.ru/AuthResult.cgi?param1=1&amp;param2=2 
Имена параметров в адресе не должны совпадать с именами параметров заказа <b>MERCHANTNUMBER, ORDERNUMBER, AMOUNT,
BACKURL, $ORDERDESCRIPTION, LANGUAGE, DEPOSITFLAG, MERCHANTPASSWD, LOGIN.</b>
Любой параметр запроса на регистрацию заказа, не совпадающий по имени с
указанными выше параметрами, трактуется как дополнительный параметр адреса <b>BACKURL</b>.</p>
<p>В случае неуспешной регистрации заказа в качестве HTTPS-ответа возвращается текстовое сообщение с описанием ошибки.</p>
<p>Пример HTTPS GET запроса на регистрацию заказа:</p>

<pre>https://playground.paymentgate.ru/bpcservlet/Merchant2Rbs?MERCHANTNUMBER=118600118604000118605&amp;ORDERNUMBER=101&amp;AMOUNT=100&amp;DEPOSITFLAG=1&amp;BACKURL=https%3A%2F%2Frbspm%3Fparam1%3D1&amp;$ORDERDESCRIPTION=desc&amp;LANGUAGE=RU&amp;MERCHANTPASSWD=12345
</pre>

<a name="4.1.1.2."><h4>4.1.1.2. Ответ в формате HTML сервера Системы РБС на запрос о регистрации заказа.</h4></a>

<p>В случае успешной регистрации заказа, сервер Системы РБС возвращает HTTPS-ответ c фрагментом HTML-кода в виде формы, 
который может быть встроен в страницу для показа Клиенту.</p>
<p>Такой HTML-код может быть применен Магазином для инициации перехода Клиента с сайта Магазина на
защищенную форму ввода данных о карте для оплаты заказа, расположенную на сайте Системы РБС.</p>
<p>Формат HTML-формы:</p>

<pre>&lt;form name="PaymentForm" action="http://playground.paymentgate.ru/bpcservlet/BPC/AcceptPayment.jsp"&gt;
    &lt;INPUT TYPE="Hidden" NAME="MDORDER" VALUE="5378-128-1980-9010164-25-51790-9822793321050"&gt; 
    &lt;INPUT TYPE="Submit" NAME="Submit" VALUE="Ok"&gt; 
&lt;/form&gt;
</pre>

<p>где значение атрибута <b>VALUE</b> HTML-тага <b>INPUT</b> с именем <b>MDORDER</b>
 представляет собой уникальный идентификатор заказа, который сайт 
Системы РБС присвоил по данному запросу на регистрацию. Т.е. однозначно 
идентифицирует Магазин, Покупателя и его конкретный заказ.</p>
<p>Уникальный идентификатор заказа (т.е. передаваемый таким образом параметр <b>MDORDER</b>) представляет собой строку длинной до 150 символов.</p>

<a name="4.1.1.3."><h4>4.1.1.3. Ответ в формате XML сервера Системы РБС на запрос о регистрации заказа.</h4></a>

<p>Если при запросе на регистрацию заказа параметр <b>MODE</b>=2, то тогда в качестве HTTP-ответа на запрос сайт Системы РБС вернет XML-документ следующего формата:</p>

<pre>&lt;?xml version="1.0" encoding="UTF-8"&gt;
    &lt;mdorder&gt;5378-128-1980-9010164-25-51790-9822793321050&lt;/mdorder&gt;
</pre>

<p>Где XML-таг <b>mdorder</b> содержит уникальный идентификатор заказа, который сайт Системы РБС присвоил по данному запросу на регистрацию.</p>
<p>Уникальный идентификатор заказа (т.е. передаваемый таким образом параметр <b>mdorder</b>) представляет собой строку длинной до 150 символов.</p>

<a name="4.1.1.4."><h4>4.1.1.4. Ответ текстовом формате сервера Системы РБС на запрос о регистрации заказа.</h4></a>

<p>Если при запросе на регистрацию заказа параметр <b>MODE</b>=1, то тогда в качестве HTTP-ответа на запрос сайт Системы РБС вернет документ, состоящий из строки следующего формата:</p>

<pre>5378-128-1980-9010164-25-51790-9822793321050
</pre>

<p>Строка является уникальным идентификатором заказа, который сайт Системы РБС присвоил по данному запросу на регистрацию.</p>
<p>Уникальный идентификатор заказа представляет собой строку длинной до 150 символов.</p>

<a name="4.1.1.5."><h4>4.1.1.5. Ответ в случае ошибки регистрации заказа.</h4></a>

<p>В случае ошибки при регистрации заказа сайт Системы РБС в ответ на 
HTTPS-запрос о регистрации заказа возвращает
сайту Магазина текстовое сообщение с описанием ошибки допущенной при 
передаче параметров регистрации или сбоя на стороне сервера.</p>
<p>Варианты возвращаемых ошибок:</p>

<table>
    <tbody><tr>
        <th>Значение</th>
        <th>Описание</th>
    </tr>
    <tr>
        <td>merchanNumber==null</td>
        <td><b>MERCHANTNUMBER</b> пустой или пропущен</td>
    </tr>
    <tr>
        <td>orderNumber==null</td>
        <td><b>ORDERNUMBER</b> пустой или пропущен</td>
    </tr>
    <tr>
        <td>orderNumber is not a number</td>
        <td><b>ORDERNUMBER</b> не является числом</td>
    </tr>
    <tr>
        <td>amount==null</td>
        <td><b>AMOUNT</b> пустой или пропущен</td>
    </tr>
    <tr>
        <td>amount must have at least 3 chars</td>
        <td><b>AMOUNT</b> должен содержать в себе не меньше трех знаков (т.к. минимальная сумма платежа 100 копеек)</td>
    </tr>
    <tr>
        <td>AMOUNT is not a number</td>
        <td><b>AMOUNT</b> не является числом</td>
    </tr>
    <tr>
        <td>depositFlag==null</td>
        <td><b>DEPOSITFLAG</b> пустой или пропущен</td>
    </tr>
    <tr>
        <td>backUrl==null</td>
        <td>Поле <b>BACKURL</b> пустое или пропущено</td>
    </tr>
    <tr>
        <td>orderDescription==null</td>
        <td>Не указан параметр описания заказа ORDERDESCRIPTION</td>
    </tr>
    <tr>
        <td>merchantPasswd==null</td>
        <td>Не указан пароль Магазина</td>
    </tr>
    <tr>
        <td>merchantPasswd incorrect</td>
        <td>Пароль Магазина неверен</td>
    </tr>
    <tr>
        <td>wrong currency code</td>
        <td>Данная валюта не поддерживается.<br>Примечение: использование валютных платежей требует дополнительного согласование я Альфа Банком</td>
    </tr>
    <tr>
        <td>System error = (далее описание ошибки)</td>
        <td>Неверна регистрация заказа: забыть како-либо важный параметр заказа, например, номер магазина - неверен.</td>
    </tr>
</tbody></table>

<a name="4.1.1.6."><h4>4.1.1.6. Ответ на запрос платежа с данными карты собранными на стороне Магазина.</h4></a>

<p>
<font size="6" color="red">Не надо читать этот пункт, если данные карты вводятся на стороне РБС</font>
</p><p>

</p><p>Ответом на HTTPS GET/POST запрос с параметрами карты Клиента служит ответ c типом HTTP-контента "plain/text" 
или "text/html" содержащий строку с тремя параметрами, разделенными символом '&amp;' <b>MDORDER</b>, <b>ANSWER</b> и <b>STATE</b>:</p>

<table>
    <tbody><tr>
        <th>Параметр</th>
        <th>Тип данных</th>
        <th>Описание</th>
    </tr>
    <tr>
        <td><b>MDORDER</b></td>
        <td>Строка до 150 символов</td>
        <td>Уникальный идентификатор заказа, полученный при регистрации заказа от Системы РБС.</td>
    </tr>
    <tr>
        <td><b>ANSWER</b></td>
        <td>Строка</td>
        <td>строка, содержащая URI-закодированный(URI-encoded) ответ в формате XML содержащий информацию о результате прохождения платежа.</td>
    </tr>
    <tr>
        <td><b>STATE</b></td>
        <td>Строка</td>
        <td>состояние платежа.<br><i><u>Примечание</u>: Значение STATE описаны ниже в данном разделе</i></td>
    </tr>
</tbody></table>
<p>Формат XML значения передаваемого через параметра <b>ANSWER</b> следующий:</p>

<pre>&lt;?xml version="1.0" encoding="UTF-8"&gt;
    &lt;PSApiResult primaryRC="0" secondaryRC="0"/&gt;
</pre>

<p>Где XML-тэг <b>PSApiResult</b> содержит в себе код возврата в виде комбинации <b>PrimaryRC</b> и <b>SecondaryRC</b>.</p>
<table>
    <tbody><tr>
        <th>Атрибут</th>
        <th>Тип данных</th>
    </tr>
    <tr>
        <td>primaryRC</td>
        <td>Целое число</td>
    </tr>
    <tr>
        <td>secondaryRC</td>
        <td>Целое число</td>
    </tr>
</tbody></table>

<p>Возможные варианты значений комбинации кодов:</p>

<table>
<tbody><tr>
<td><b>PRIMARYCODE</b></td>
<td><b>SECONDARYCODE</b></td>
<td><b>Описание</b></td>
</tr>
<tr>
<td>-9</td>

<td>-1</td>
<td>Сбой в процессинге</td>
</tr>
<tr>
<td>-9</td>
<td>1014</td>
<td>не используется</td>

</tr>
<tr>
<td>-2</td>
<td>0</td>
<td>Номер карты(BIN, маска) внесен в черный список антифродового фильтра</td>
</tr>
<tr>
<td>-2</td>
<td>1</td>

<td><font color="black">IP-адрес внесен в черный список антифродового фильтра</font></td>
</tr>
<tr>
<td>-2</td>
<td>2</td>
<td><font color="black">Превышен лимит по карте(BINу, маске) согласно настройкам антифродового фильтра</font></td>
</tr>

<tr>
<td>-2</td>
<td>-3</td>
<td>SSL (Не VbV/SecureCode) транзакции запрещены Магазину</td>
</tr>
<tr>
<td>-2</td>

<td>-4</td>
<td>MOTO (без cvc/cvv2 кода) транзакции запрещены Магазину</td>
</tr>
<tr>
<td>-2</td>
<td>5</td>
<td>VbV/SecureCode аутентификация не прошла. Т.к. не удалось проверить подпись эмитента 

(то есть PARes был читаемый, но подписан неверно).</td>
</tr>
<tr>
<td>-2</td>
<td>6</td>
<td>Эмитент отклонил&nbsp; VbV/SecureCode аутентификацию.</td>
</tr>
<tr>

<td>-2</td>
<td>7</td>
<td>Срок действия транзакции был превышен к моменту ввода данных карты. (таймаут 2 часа)</td>
</tr>
<tr>
<td>-2</td>

<td>8</td>
<td>Контрольный SMS введен не верно</td>
</tr>
<tr>
<td>-2</td>
<td>9</td>

<td>Телефон привязанный к карте либо не найден, либо телефоном (10 цифр) не является</td>
</tr>
<tr>
<td>-2</td>
<td>10</td>
<td>Превышен лимит магазина по максимальной сумме транзакции</td>

</tr>
<tr>
<td>-2</td>
<td>11</td>
<td>Превышен общий дневной лимит магазина</td>
</tr>
<tr>
<td>-2</td>

<td>12</td>
<td>Недопустимое имя кардходера</td>
</tr>
<tr>
<td>-2</td>
<td>13</td>

<td>Страна данного BINа находится в черном списке или не находится в списке допустимых стран</td>
</tr>
<tr>
<td>-2</td>
<td>14</td>
<td>Аэропорт находится в черном списке</td>

</tr>
<tr>
<td>-2</td>
<td>15</td>
<td>Страна данного IP находится в черном списке или не находится в списке допустимых стран</td>
</tr>
<tr>
<td>-2</td>

<td>101</td>
<td>E-mail находится в черном списке (Аэрофлот)</td>
</tr>
<tr>
<td>-2</td>
<td>102</td>

<td>Имя пассажира находится в черном списке (Аэрофлот)</td>
</tr>
<tr>
<td>-1</td>
<td>-1</td>
<td><font color="black">Выставляется в момент регистрации платежа</font>
<font color="black">(т.е. когда еще по транзакции не было никаких действий).</font></td>

</tr>
<tr>
<td>0</td>
<td>0</td>
<td>успех</td>
</tr>
<tr>
<td>7</td>

<td>1015</td>
<td>Введены неправильные параметры карты</td>
</tr>
<tr>
<td>8</td>
<td>204</td>
<td><font color="black">Такой заказ уже регистрировали (проверка по ORDERNUMBER)</font></td>

</tr>
<tr>
<td>11</td>
<td>205</td>
<td>не используется</td>
</tr>
<tr>
<td>15</td>

<td>1017</td>
<td>VbV/SecureCode&nbsp; - ошибка связи</td>
</tr>
<tr>
<td>15</td>
<td>1018</td>

<td>Таймаут в процессинге. вроде бы не удалось отправить</td>
</tr>
<tr>
<td>15</td>
<td>1019</td>
<td>Таймаут в процессинге. вроде бы удалось отправить</td>
</tr>

<tr>
<td>15</td>
<td>21010</td>
<td>не используется</td>
</tr>
<tr>
<td>34</td>

<td>1014</td>
<td>неуспешная транзакция. см. подробности в ACTION_CODE</td>
</tr>
<tr>
<td>34</td>
<td>1041</td>
<td>refund failed</td>

</tr>
<tr>
<td>200</td>
<td>1</td>
<td>Фродовая транзакция. Согласно данным полученным от процессига или/и платежной сети.</td>
</tr>
</tbody></table>

<p>Значения параметра <b>STATE:</b></p>

<table>
    <tbody><tr>
        <th>Значение</th>
        <th>Описание</th>
    </tr>
    <tr>
        <td>payment_approved</td>
        <td>Платеж
         предавторизован. Состояние означает, что процесс предавторизации платежа в
         Системе РБС прошел успешно. Для данного состояния могут быть выполнены
         команды поставторизации или отмены предавторизации платежа.</td>
    </tr>
    <tr>
        <td>payment_deposited</td>
        <td>Платеж поставторизован. Состояние означает, что процесс 
поставторизации платежа в Системе РБС прошел успешно. Для данного 
состояния 
        может быть выполнена команда отмены поставторизации платежа.</td>
    </tr>
    <tr>
        <td>payment_declined</td>
        <td>Состояние означает, что процесс предавторизации платежа в Системе РБС был отклонен Банком.</td>
    </tr>
</tbody></table>

<p>Можно быть уверенным, что платеж прошел успешно, если primaryRC="0" secondaryRC="0" и STATE=payment_deposited</p>

<p>Пример ответа:</p>

<pre>MDORDER=1792-36-52-69-97-710-10864-102-102-8085-79116&amp;ANSWER=%3C%3Fxml+version%3D%221.0%22+encoding%3D%22UTF-8%22%3F%3E%0A%3CPSApiResult+primaryRC%3D%2234%22+secondaryRC%3D%22171%22%2F%3E&amp;STATE=payment_deposited
</pre>

<a name="4.1.2."><h3>4.1.2. Подробное описание оплаты заказа (одностадийный или двухстадийный платеж).</h3></a>

<a name="4.1.2.1."><h4>4.1.2.1. Порядок проведения оплаты.</h4></a>

<p>Покупатель перенаправляется с сайта Магазина на адрес указанный в полученной HTML-форме на страницу ввода параметров банковской
карты на сервере РБС.</p>

<p>Адрес страницы ввода параметров банковской карты на тестовом сервере:</p>

<pre>https://playground.paymentgate.ru/bpcservlet/BPC/AcceptPayment.jsp?MDORDER=значение_MDORDER
</pre>

<p>Адрес страницы ввода параметров банковской карты на "боевом" сервере:</p>

<pre>https://engine.paymentgate.ru/bpcservlet/BPC/AcceptPayment._имя_магазина.jsp?MDORDER=значение_MDORDER
</pre>

<p>где MDORDER представляет собой уникальный идентификатор заказа полученный после шага 1 (см. рисунок 1 или пп. 4.1.1.2-4.1.1.4)<br>
Обычно страница AcceptPayment._имя_магазина.jsp сделана в стиле дизайна интернет магазина.<br>
<i><u>Примечание</u>: <a href="https://www.paymentgate.ru/bpcservlet/BPC/Connection.jsp">Внешний вид страницы AcceptPayment.jsp можно настроить в соответствии с дизайном сайта Магазина.</a> 
</i></p>

<p>Сервер Системы РБС сопоставляет клиента с заказом по идентификатору <b>MDORDER</b>
 полученному Магазином от Системы РБС в
результате регистрации заказа и переданному обратно при переходе 
покупателя по ссылке или (нажатии кнопки формы) с сайта Магазина на 
страницу 
оплаты расположенную на сайте Системы РБС.</p>

<p>На странице AcceptPayment.jsp клиенту будет предложено ввести параметры своей пластиковой карты, такие как номер карты, 
срок действия, CVC2/CVV2 код. Также при наличии в первичном запросе регистрации заказа параметра <b>LOGIN</b> клиенту будет 
предложено ввести известное только ему и сайту Магазина значение.</p>

<p>После нажатия кнопки "Оплатить" происходит передача данных по защищенному HTTPS/SSL2-3 каналу на сервер Системы РБС, и сервер, 
в качестве HTTP-ответа, производит переадресацию браузер Клиента по адресу <b>BACKURL</b>, указанному при регистрации заказа на первом этапе.</p>

<a name="4.1.2.2."><h4>4.1.2.2. Возврат Клиента обратно на Сайт Магазина
 с одновременной передачей информации с результатами оплаты от Системы 
РБС обратно Магазину.</h4></a>

<p>Ответ сервера РБС содержит параметр <b>ANSWER</b> с результатами оплаты заказа в формате XML (URI-закодированный).</p>

<p>Пример ответа:</p>

<pre>&lt;?xml version="1.0" encoding="UTF-8"&gt;
    &lt;PSApiResult primaryRC="0" secondaryRC="0"/&gt;
</pre>

<p>XML-тэг <b>PSApiResult</b> содержит в себе кода возврата в виде комбинации <b>PrimaryRC</b> и <b>SecondaryRC</b>.</p>
<table>
    <tbody><tr>
        <th>Параметр</th>
        <th>Тип данных</th>
    </tr>
    <tr>
        <td>primaryRC</td>
        <td>Целое число</td>
    </tr>
    <tr>
        <td>secondaryRC</td>
        <td>Целое число</td>
    </tr>
</tbody></table>

<p>Возможные варианты значений
комбинации кодов:</p>

<table>
<tbody><tr>
<td><b>PRIMARYCODE</b></td>
<td><b>SECONDARYCODE</b></td>
<td><b>Описание</b></td>
</tr>
<tr>
<td>-9</td>

<td>-1</td>
<td>Сбой в процессинге</td>
</tr>
<tr>
<td>-9</td>
<td>1014</td>
<td>не используется</td>

</tr>
<tr>
<td>-2</td>
<td>0</td>
<td>Номер карты(BIN, маска) внесен в черный список антифродового фильтра</td>
</tr>
<tr>
<td>-2</td>
<td>1</td>

<td><font color="black">IP-адрес внесен в черный список антифродового фильтра</font></td>
</tr>
<tr>
<td>-2</td>
<td>2</td>
<td><font color="black">Превышен лимит по карте(BINу, маске) согласно настройкам антифродового фильтра</font></td>
</tr>

<tr>
<td>-2</td>
<td>-3</td>
<td>SSL (Не VbV/SecureCode) транзакции запрещены Магазину</td>
</tr>
<tr>
<td>-2</td>

<td>-4</td>
<td>MOTO (без cvc/cvv2 кода) транзакции запрещены Магазину</td>
</tr>
<tr>
<td>-2</td>
<td>5</td>
<td>VbV/SecureCode аутентификация не прошла. Т.к. не удалось проверить подпись эмитента 

(то есть PARes был читаемый, но подписан неверно).</td>
</tr>
<tr>
<td>-2</td>
<td>6</td>
<td>Эмитент отклонил&nbsp; VbV/SecureCode аутентификацию.</td>
</tr>
<tr>

<td>-2</td>
<td>7</td>
<td>Срок действия транзакции был превышен к моменту ввода данных карты. (таймаут 2 часа)</td>
</tr>
<tr>
<td>-2</td>

<td>8</td>
<td>Контрольный SMS введен не верно</td>
</tr>
<tr>
<td>-2</td>
<td>9</td>

<td>Телефон привязанный к карте либо не найден, либо телефоном (10 цифр) не является</td>
</tr>
<tr>
<td>-2</td>
<td>10</td>
<td>Превышен лимит магазина по максимальной сумме транзакции</td>

</tr>
<tr>
<td>-2</td>
<td>11</td>
<td>Превышен общий дневной лимит магазина</td>
</tr>
<tr>
<td>-2</td>

<td>12</td>
<td>Недопустимое имя кардходера</td>
</tr>
<tr>
<td>-2</td>
<td>13</td>

<td>Страна данного BINа находится в черном списке или не находится в списке допустимых стран</td>
</tr>
<tr>
<td>-2</td>
<td>14</td>
<td>Аэропорт находится в черном списке</td>

</tr>
<tr>
<td>-2</td>
<td>15</td>
<td>Страна данного IP находится в черном списке или не находится в списке допустимых стран</td>
</tr>
<tr>
<td>-2</td>

<td>101</td>
<td>E-mail находится в черном списке (Аэрофлот)</td>
</tr>
<tr>
<td>-2</td>
<td>102</td>

<td>Имя пассажира находится в черном списке (Аэрофлот)</td>
</tr>
<tr>
<td>-1</td>
<td>-1</td>
<td><font color="black">Выставляется в момент регистрации платежа</font>
<font color="black">(т.е. когда еще по транзакции не было никаких действий).</font></td>

</tr>
<tr>
<td>0</td>
<td>0</td>
<td>успех</td>
</tr>
<tr>
<td>7</td>

<td>1015</td>
<td>Введены неправильные параметры карты</td>
</tr>
<tr>
<td>8</td>
<td>204</td>
<td><font color="black">Такой заказ уже регистрировали (проверка по ORDERNUMBER)</font></td>

</tr>
<tr>
<td>11</td>
<td>205</td>
<td>не используется</td>
</tr>
<tr>
<td>15</td>

<td>1017</td>
<td>VbV/SecureCode&nbsp; - ошибка связи</td>
</tr>
<tr>
<td>15</td>
<td>1018</td>

<td>Таймаут в процессинге. вроде бы не удалось отправить</td>
</tr>
<tr>
<td>15</td>
<td>1019</td>
<td>Таймаут в процессинге. вроде бы удалось отправить</td>
</tr>

<tr>
<td>15</td>
<td>21010</td>
<td>не используется</td>
</tr>
<tr>
<td>34</td>

<td>1014</td>
<td>неуспешная транзакция. см. подробности в ACTION_CODE</td>
</tr>
<tr>
<td>34</td>
<td>1041</td>
<td>refund failed</td>

</tr>
<tr>
<td>200</td>
<td>1</td>
<td>Фродовая транзакция. Согласно данным полученным от процессига или/и платежной сети.</td>
</tr>
</tbody></table>

<p><i><u>Примечание</u>: Успешное выполнение команд не гарантирует успешного
прохождения платежа, как проверить состояние платежа описано в пункте "<a href="#4.5.">Запрос состояния платежа</a>;

<a name="4.2."></a></i></p><h2><i><a name="4.2.">4.2. Завершение двухстадийного платежа. (Проведение отложенной авторизации).</a></i></h2><i>

<a name="4.2.1."><h3>4.2.1. Инициация Завершения двухстадийного платежа.</h3></a>

<p>В том случае, если при регистрации заказа (<b>описание параметров в пп.4.1.1.1. "Запрос на регистрацию заказа"</b>) запрос содержал параметр <b>DEPOSITFLAG=0</b>, т.е. регистрировался
двухстадийный платеж, то при оплате сумма блокируется на счету клиента и не
переводится на счет Магазина до тех пор пока Магазин
не осуществит операцию "Завершение".</p>
<p><i><u>Примечание</u>: Банк-эмитент у себя устанавливает timeout, по наступлению которого заблокированные средства
на счету клиента подлежат автоматической разблокировке. Обычно это 30 дней.</i></p>
<p>Есть два пути перевода на счет Магазина заблокированных
денег: в личном кабинете магазина на сайте www.paymentgate.ru (тестовый
сервер playground.paymentgate.ru) или HTTPS запросом: программное обеспечение Магазина должно сформировать
HTTPS GET или POST запрос на адрес:</p>

<pre>https://playground.paymentgate.ru/bpcservlet/DepositPayment
</pre>

<p>Запрос должен содержать следующие параметры:</p>

<table>
    <tbody><tr>
        <th>Название параметра</th>
        <th>Тип данных, формат</th>
        <th>Обязательный параметр</th>
        <th>Описание</th>
    </tr>
    <tr>
        <td>MDORDER</td>
        <td>Строка, длиной до 150 символов</td>
        <td>Да</td>
        <td>Уникальный идентификатор заказа, полученный при регистрации заказа от Системы РБС.</td>
    </tr>
    <tr>
        <td>MERCHANTPASSWD</td>
        <td>Строка длиной до 20 символов</td>
        <td>Да</td>
        <td>пароль Магазина. полученный при регистрации в Системе РБС</td>
    </tr>
    <tr>
        <td>DEPOSIT_AMOUNT</td>
        <td>Целое число</td>
        <td>Нет</td>
        <td>Необязательный параметр. 
            Сумма в копейках, на которую будет производно завершение 
платежа. 
            Блокировка средств на карте на сумму разницы между 
заблокированной суммой и суммой завершения будет автоматически отменена.
            Если данный параметр не указан то с карты покупателя будет 
списана целиком вся сумма, на которую первоначально была сделана 
блокировка.
        </td>
    </tr>
</tbody></table>

<p><i><u>Примечание</u>: При
формировании запроса ВСЕ ИМЕНА ПАРАМЕТРОВ ЧУВСТВИТЕЛЬНЫ К РЕГИСТРУ И ДОЛЖНЫ
БЫТЬ НАБРАНЫ ЗАГЛАВНЫМИ БУКВАМИ.</i></p>
<p><i> </i></p>
<p>Пример HTTPS GET запроса на операцию "Завершение":</p>

<pre>https://playground.paymentgate.ru/bpcservlet/DepositPayment?MDORDER=5378-128-1980-9010164-25-51790-9822793321050&amp;MERCHANTPASSWD=3edcvbn
</pre>

<a name="4.2.2."><h3>4.2.2. Ответ сайта Системы РБС на завершение двухстадийного платежа.</h3></a>

<p>На HTTPS GET/POST запрос об операции "Завершение"
сервер РБС возвращает XML-документ с результатом завершения заказа.</p>
<p>Пример ответа:</p>

<pre>&lt;?xml version="1.0" encoding="UTF-8"&gt;
    &lt;PSApiResult primaryRC="0" secondaryRC="0"/&gt;
</pre>

<p>XML-тэг <b>PSApiResult</b> содержит в себе кода возврата в виде комбинации <b>PrimaryRC</b> и <b>SecondaryRC</b>.</p>

<table>
    <tbody><tr>
        <th>Параметр</th>
        <th>Тип данных</th>
    </tr>
    <tr>
        <td>primaryRC</td>
        <td>Целое число</td>
    </tr>
    <tr>
        <td>secondaryRC</td>
        <td>Целое число</td>
    </tr>
</tbody></table>

<p>Возможные варианты значений комбинации кодов:</p>

<table>
    <tbody><tr>
        <th>primaryRC</th>
        <th>secondaryRC</th>
        <th>Описание</th>
    </tr>
    <tr>
        <td>0</td>
        <td>0</td>
        <td>платеж успешно прошел</td>
    </tr>
    <tr>
        <td>34</td>
        <td>1014</td>
        <td>платеж не прошел по финансовым причинам</td>
    </tr>
    <tr>
        <td>15</td>
        <td>1018</td>
        <td>нет связи с Банком-эквайером</td>
    </tr>
    <tr>
        <td>15</td>
        <td>1019</td>
        <td>Удалось отправить транзакцию в Банк-эквайер, но ответа не получили</td>
    </tr>
    <tr>
        <td>2</td>
        <td>204</td>
        <td>Заказ с данным MDORDER не найден</td>
    </tr>
</tbody></table>

<p><i><u>Примечание</u>: Успешное выполнение команд не гарантирует успешного прохождения платежа, как проверить состояние платежа описано в пункте "<a href="#4.5.">Запрос состояния платежа</a>;"</i></p>


<a name="4.3."><h2>4.3. Отмена отложенной авторизации двухстадийного платежа. Снятие блокировки средств на счету клиента.</h2></a>


<a name="4.3.1."><h3>4.3.1. Инициация Снятие блокировки средств на счету клиента.</h3></a>

<p>В том случае, если при регистрации заказа (<b>описание параметров в пп.4.1.1.1. "Запрос на регистрацию заказа"</b>)
запрос содержал параметр DEPOSITFLAG=0, то сумма блокировалась
на счету клиента, но не переводилась на счет Магазина.</p>
<p>Перевод денег откладывался до момента операции " Завершение двухстадийного платежа".</p>
<p>Для снятия блокировки средств на счету Покупателя программное обеспечение Магазина должно
сформировать HTTPS GET или POST запрос по адресу:</p>

<pre>https://playground.paymentgate.ru/bpcservlet/DepositReversal
</pre>

<p><i><u>Примечание</u>: Данная операция возможна только для заказов, по которым была проведена операция отложенной авторизации.</i></p>

<p>Запрос должен содержать параметры:</p>

<table>
    <tbody><tr>
        <th>Название параметра</th>
        <th>Тип данных, формат</th>
        <th>Обязательный параметр</th>
        <th>Описание</th>
    </tr>
    <tr>
        <td>MDORDER</td>
        <td>Строка, длиной до 150 символов</td>
        <td>Да</td>
        <td>Уникальный идентификатор заказа, полученный при регистрации заказа от Системы РБС.</td>
    </tr>
    <tr>
        <td>MERCHANTPASSWD</td>
        <td>Строка длиной до 20 символов</td>
        <td>Да</td>
        <td>пароль Магазина, полученный при регистрации в Системе РБС</td>
    </tr>
</tbody></table>

<p>Пример HTTPS GET запроса на операцию "Отмена отложенной авторизации":</p>

<pre>https://playground.paymentgate.ru/bpcservlet/DepositReversal?MDORDER=5378-128-1980-9010164-25-51790-9822793321050&amp;MERCHANTPASSWD=3edcvbn
</pre>

<p>Также отмена возможна в личном кабинете магазина.</p>

<a name="4.3.2."><h3>4.3.2. Ответ сайта Системы РБС на запрос о Снятии блокировки средств на счету клиента.</h3></a>

<p>После проведения операции отмены сервер Системы РБС возвращает XML документ с результатами отмены отложенной авторизации.</p>

<p>Пример ответа:</p>

<pre>&lt;?xml version="1.0" encoding="UTF-8"&gt;
    &lt;PSApiResult primaryRC="0" secondaryRC="0"/&gt;
</pre>

<p>XML-тэг <b>PSApiResult</b> содержит в себе кода возврата в виде комбинации <b>PrimaryRC</b> и <b>SecondaryRC</b>.</p>

<table>
    <tbody><tr>
        <th>Параметр</th>
        <th>Тип данных</th>
    </tr>
    <tr>
        <td>primaryRC</td>
        <td>Целое число</td>
    </tr>
    <tr>
        <td>secondaryRC</td>
        <td>Целое число</td>
    </tr>
</tbody></table>

<p>Возможные варианты значений комбинации кодов:</p>

<table>
    <tbody><tr>
        <th>primaryRC</th>
        <th>secondaryRC</th>
        <th>Описание</th>
    </tr>
    <tr>
        <td>0</td>
        <td>0</td>
        <td>Платеж прошел успешно</td>
    </tr>
    <tr>
        <td>34</td>
        <td>1014</td>
        <td>Платеж не прошел по финансовым причинам</td>
    </tr>
    <tr>
        <td>15</td>
        <td>1018</td>
        <td>Нет связи с Банком-эквайером</td>
    </tr>
    <tr>
        <td>15</td>
        <td>1019</td>
        <td>Удалось отправить транзакцию в Банк-эквайер, но ответа не получили</td>
    </tr>
    <tr>
        <td>2</td>
        <td>204</td>
        <td>Заказ с данным MDORDER не найден</td>
    </tr>
</tbody></table>

<a name="4.3.3."><h3>4.3.3. Ответ сайта Системы РБС на некорректный запрос о Снятии блокировки средств на счету клиента или завершении платежа.</h3></a>

<p>При ошибочных параметрах запроса система вернет текстовое сообщение описания ошибки, например, </p><pre>merchant password is wrong</pre><p></p>

<a name="4.4."><h2>4.4. Отмена одностадийного платежа.</h2></a>

<p><i><u>Примечание:</u> По стандартному договору между интернет магазином и Альфа Банком отмена через web интерфейс 
одностадийного платежа невозможна. Для отмены таких платежей нужно отправить электронное письмо установленной формы на 
соответствующий адрес Альфа Банка. Форма письма и адрес указаны в договоре. При заключении дополнительного соглашения 
возможна отмена вышеописанных платежей через web интерфейс как в личном кабинете, так и HTTPS GET/POST командой.</i></p>

<a name="4.4.1."><h3>4.4.1. Инициация отмены одностадийного платежа.</h3></a>

<p>Для отмены одностадийного платежа программное обеспечение Магазина должно сформировать HTTPS GET или POST запрос по адресу:</p>

<pre>https://playground.paymentgate.ru/bpcservlet/DepositReversal
</pre>

<p>Запрос должен содержать параметры</p>

<table>
    <tbody><tr>
        <th>Название параметра</th>
        <th>Тип данных, формат</th>
        <th>Обязательный параметр</th>
        <th>Описание</th>
    </tr>
    <tr>
        <td>MDORDER</td>
        <td>Строка, длиной до 150 символов</td>
        <td>да</td>
        <td>Уникальный идентификатор заказа, полученный при регистрации заказа от Системы РБС.</td>
    </tr>
    <tr>
        <td>MERCHANTPASSWD</td>
        <td>Строка длиной до 20 символов</td>
        <td>да</td>
        <td>пароль Магазина, полученный при регистрации в Системе РБС</td>
    </tr>
    <tr>
        <td>user</td>
        <td>Строка длиной до 20 символов</td>
        <td>да</td>
        <td>логин дополнительной аутентификации пользователя проводящего возврат</td>
    </tr>
    <tr>
        <td>pwd</td>
        <td>Строка длиной до 20 символов</td>
        <td>да</td>
        <td>пароль дополнительной аутентификации пользователя проводящего возврат</td>
    </tr>
</tbody></table>

<p>Пример HTTPS GET запроса на операцию "Отмена платежа":</p>

<pre>https://playground.paymentgate.ru/bpcservlet/DepositReversal?MDORDER=5378-128-1980-9010164-25-51790-9822793321050&amp;MERCHANTPASSWD=3edcvbn&amp;user=finmanager&amp;pwd=qweasd
</pre>

<p>Также отмена возможна в личном кабинете магазина.</p>

<a name="4.4.2."><h3>4.4.2. Ответ сайта Системы РБС на запрос об отмене одностадийного платежа.</h3></a>

<p>После проведения операции отмены сервер РБС возвращает XML документ с результатами отмены платежа.</p>

<p>Пример ответа:</p>

<pre>&lt;?xml version="1.0" encoding="UTF-8"&gt;
    &lt;PSApiResult primaryRC="0" secondaryRC="0"/&gt;
</pre>

<p>XML-тэг <b>PSApiResult</b> содержит в себе кода возврата в виде комбинации <b>PrimaryRC</b> и <b>SecondaryRC</b>.</p>
<table>
    <tbody><tr>
        <th>Параметр</th>
        <th>Тип данных</th>
    </tr>
    <tr>
        <td>primaryRC</td>
        <td>Целое число</td>
    </tr>
    <tr>
        <td>secondaryRC</td>
        <td>Целое число</td>
    </tr>
</tbody></table>

<p>Возможные варианты значений комбинации кодов:</p>

<table>
    <tbody><tr>
        <th>primaryRC</th>
        <th>secondaryRC</th>
        <th>Описание</th>
    </tr>
    <tr>
        <td>0</td>
        <td>0</td>
        <td>платеж успешно прошел</td>
    </tr>
    <tr>
        <td>34</td>
        <td>1014</td>
        <td>платеж не прошел по финансовым причинам</td>
    </tr>
    <tr>
        <td>15</td>
        <td>1018</td>
        <td>нет связи с Банком-эквайером</td>
    </tr>
    <tr>
        <td>15</td>
        <td>1019</td>
        <td>Удалось отправить транзакцию в Банк-эквайер, но ответа не получили</td>
    </tr>
    <tr>
        <td>2</td>
        <td>204</td>
        <td>Заказ с данным MDORDER не найден</td>
    </tr>
</tbody></table>

<a name="4.5."><h2>4.5. Запрос состояния платежа.</h2></a>

<p>Есть два способа проверки состояния платежа:</p>
<ol>
    <li>1. Зайти на сайт РБС www.paymentgate.ru в раздел "Для 
Магазинов", войти в систему с именем и паролем Магазина, перейти в 
раздел "Статистика" и посмотреть состояние интересующего платежа.</li>
    <li>2. Программное обеспечение Магазина формирует специальный HTTPS GET или POST запрос по адресу</li>
</ol>

<pre>https://playground.paymentgate.ru/bpcservlet/QueryOrders
</pre>

<p>Запрос должен содержать параметры</p>

<table>
    <tbody><tr>
        <th>Название параметра</th>
        <th>Тип данных, формат</th>
        <th>Обязательный параметр</th>
        <th>Описание</th>
    </tr>
    <tr>
        <td>MDORDER</td>
        <td>Строка, длиной до 150 символов</td>
        <td>Да</td>
        <td>Уникальный идентификатор заказа, полученный при регистрации заказа от Системы РБС.</td>
    </tr>
    <tr>
        <td>MERCHANTPASSWD</td>
        <td>Строка длиной до 20 символов</td>
        <td>Да</td>
        <td>пароль Магазина, полученный при регистрации в Системе РБС</td>
    </tr>
</tbody></table>

<p>Пример HTTPS GET запроса на операцию "Проверка состояния заказа":</p>

<pre>https://playground.paymentgate.ru/bpcservlet/QueryOrders?MDORDER=5378-128-1980-9010164-25-51790-9822793321050&amp;MERCHANTPASSWD=3edcvbn
</pre>

<p>В ответ сервер Системы РБС возвращает XML документ.</p>
<p>Пример ответа на запрос проверки состояния заказа:</p>

<pre>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
    &lt;PSApiResult objectCount="1" primaryRC="0" secondaryRC="0"&gt;
        &lt;PSOrder amount="123456789" currency="810" merchantNumber="123456789" orderNumber="123456789" state="order_ordered"&gt;
            &lt;PaymentCollection&gt;
                &lt;PSPayment approvalCode="207433" approveAmount="123456789" authCode="0"
                authTime="Thu Mar 14 12:10:24 GMT+03:00 2002" capCode="0"
                depositAmount="123456789" paymentNumber="123456789" 
                paymentType="BPC" payment_state="payment_deposited" 
                pan="412345..1234"/&gt;
            &lt;/PaymentCollection&gt;
        &lt;/PSOrder&gt;
    &lt;/PSApiResult&gt;
</pre>

<table>
    <tbody><tr>
        <th>Таги и атрибуты тагов</th>
        <th>Тип данных</th>
        <th>Описание</th>
    </tr>
    <tr>
        <td><b>PSApiResult</b></td>
        <td>Таг</td>
        <td></td>
    </tr>
    <tr>
        <td>objectCount</td>
        <td>Целое десятичное число.</td>
        <td>Всегда 1</td>
    </tr>
    <tr>
        <td>primaryRC</td>
        <td>Целое десятичное число.</td>
        <td rowspan="2">Результат прохождения команды QueryOrders. Список возможных значений приведен ниже в данном разделе.</td>
    </tr>
    <tr>
        <td>secondaryRC</td>
        <td>Целое десятичное число.</td>
    </tr>
    <tr>
        <td colspan="3">&nbsp;</td>
    </tr>
    <tr>
        <td><b>PSOrder</b></td>
        <td>Таг</td>
        <td>В <b>PSApiResult</b> всегда один <b>PSOrder</b></td>
    </tr>
    <tr>
        <td>amount</td>
        <td>Целое десятичное число.</td>
        <td>Сумма платежа в копейках</td>
    </tr>
    <tr>
        <td>Currency</td>
        <td>Целое десятичное число.</td>
        <td>Валюта. Всегда рубли = 810</td>
    </tr>
    <tr>
        <td>merchantNumber</td>
        <td>Целое десятичное число.</td>
        <td>Уникальный идентификатор Магазина в Системе РБС</td>
    </tr>
    <tr>
        <td>orderNumber</td>
        <td>Целое десятичное число.</td>
        <td>Уникальный номер заказа созданный Магазином в момент 
регистрации заказа (или если платеж принимается на стороне магазина то в
 момент проведения платежа)</td>
    </tr>
    <tr>
        <td>State</td>
        <td>Строка</td>
        <td>Всегда order_ordered для совершенных платежей.</td>
    </tr>
    <tr>
        <td colspan="3">&nbsp;</td>
    </tr>
    <tr>
        <td><b>PaymentCollection</b></td>
        <td>Таг</td>
        <td>В <b>PSOrder всегда один PaymentCollection</b></td>
    </tr>
    <tr>
        <td colspan="3">&nbsp;</td>
    </tr>
    <tr>
        <td><b>PSPayment</b></td>
        <td>Таг</td>
        <td>В <b>PaymentCollection всегда один PSPayment</b></td>
    </tr>
    <tr>
        <td>approvalCode</td>
        <td>Строка длинной 6 символов</td>
        <td>Код авторизации платежа возвращаемый эмитентом карты.<br> Если не равен 000000, то платеж успешен.</td>
    </tr>
    <tr>
        <td>approveAmount</td>
        <td>Целое десятичное число.</td>
        <td>Значение суммы заблокированной на карте клиента. <br>Значение указано в копейках. <br>Например, 4378, что соответствует сумме 43 рубля 78 копеек.</td>
    </tr>
    <tr>
        <td>authCode</td>
        <td>Целое десятичное число.</td>
        <td>Состояние операции. <br><i><u>Примечание</u>: Значения AuthCode описаны в отдельной таблице, в данном разделе</i></td>
    </tr>
    <tr>
        <td>authTime</td>
        <td>Дата и Время по Москве</td>
        <td>Дата и время операции <br>Пример: <pre>Thu Mar 14 12:10:24 GMT+03:00 2002</pre></td>
    </tr>
    <tr>
        <td>capCode</td>
        <td>Целое десятичное число.</td>
        <td>Зарезервированное значение. Всегда 0</td>
    </tr>
    <tr>
        <td>depositAmount</td>
        <td>Целое десятичное число.</td>
        <td>Значение суммы переведенной на счет Магазина с карты клиента. <br>Значение указано в копейках. <br>Например, 4378, что соответствует сумме 43 рубля 78 копеек.</td>
    </tr>
    <tr>
        <td>paymentNumber</td>
        <td>Целое десятичное число.</td>
        <td>Всегда 1</td>
    </tr>
    <tr>
        <td>paymentType</td>
        <td>Строка</td>
        <td>Зарезервированное значение. Тип платежного протокола. Всегда BPC</td>
    </tr>
    <tr>
        <td>payment_state</td>
        <td>Строка</td>
        <td>Состояние платежа. Список возможных значений приведен ниже в данном разделе.</td>
    </tr>
    <tr>
        <td>pan</td>
        <td>Строка</td>
        <td>Маскированный номер карты</td>
    </tr>
</tbody></table>

<p>Возможные варианты значений комбинации кодов primaryRC и secondaryRC:</p>

<table>
    <tbody><tr>
        <th>primaryRC</th>
        <th>secondaryRC</th>
        <th>Описание</th>
    </tr>
    <tr>
        <td>0</td>
        <td>0</td>
        <td>Операция запроса состояния заказа прошла успешно.</td>
    </tr>
    <tr>
        <td>2</td>
        <td>204</td>
        <td>Заказ с данным MDORDER не найден</td>
    </tr>
</tbody></table>

<p><b>Значения AuthCode.</b> AuthCode является критерием успешности прохождения платежа.</p>

<table>
    <tbody><tr>
        <th>AuthCode</th>
        <th>Описание</th>
    </tr>
    <tr>
        <td>0</td>
        <td>платеж прошел успешно</td>
    </tr>
    <tr>
        <td>1</td>
        <td>Неопределенная ошибка</td>
    </tr>
    <tr>
        <td>2</td>
        <td>отклонен эмитентом</td>
    </tr>
    <tr>
        <td>3</td>
        <td>не получен ответ от эмитента</td>
    </tr>
    <tr>
        <td>4</td>
        <td>ошибка на стороне эмитента</td>
    </tr>
    <tr>
        <td>5</td>
        <td>неправильно указанна сумма платежа - не хватает денег</td>
    </tr>
    <tr>
        <td>6</td>
        <td>срок действия карты истек</td>
    </tr>
    <tr>
        <td>7</td>
        <td>по данной карте запрещены интернет транзакции</td>
    </tr>
    <tr>
        <td>8</td>
        <td>ошибка в формате данных</td>
    </tr>
    <tr>
        <td>10</td>
        <td>вы прислали платеж превышающий ваши лимиты</td>
    </tr>
    <tr>
        <td>11</td>
        <td>прислано завершение на просроченный платеж</td>
    </tr>
    <tr>
        <td>12</td>
        <td>транзакция неправильно сформирована с точки зрения эмитента</td>
    </tr>
    <tr>
        <td>13</td>
        <td>транзакция неправильно сформирована с точки зрения эмитента</td>
    </tr>
</tbody></table>

<p>
Также в личном кабинет, в детальном описании платежа можно найти параметр <b>actionCode</b>.
Данный параметр более подробно описывает причину отлонения платежа:
</p><p>

</p><table>
    <tbody><tr>
        <td>005</td><td>Отказ сети проводить транзакцию.</td>
    </tr><tr>
        <td>100</td><td>Банк эмитент запретил интернет транзакции по карте.</td>
    </tr><tr>
        <td>101</td><td>Истек срок действия карты.</td>
    </tr><tr>
        <td>103</td><td>Торговой точке необходимо связаться с банком-эмитентом.</td>
    </tr><tr>
        <td>104</td><td>Попытка выполнения операции по счету, на использование которого наложены ограничения.</td>
    </tr><tr>
        <td>106</td><td>Превышено допустимое число попыток ввода ПИН (в железном банкомате). Вероятно карта временно заблокирована.</td>
    </tr><tr>
        <td>116</td><td>Сумма транзакции превышает доступный остаток средств на выбранном счете.</td>
    </tr><tr>
        <td>120</td><td>Отказ эмитента проводить транзакцию. <br>Чаще всего возникает при запретах наложенных на карту.<br>Например, карта запрещена к использованию в интренете</td>
    </tr><tr>
        <td>121</td><td>Предпринята попытка выполнить транзакцию на сумму, превышающую дневной лимит, заданный банком-эмитентом</td>
    </tr><tr>
        <td>123</td><td>Превышен лимит на число транзакций: клиент 
выполнил максимально разрешенное число транзакций в течение лимитного 
цикла и пытается провести еще одну.</td>
    </tr><tr>
        <td>125</td><td>Неверный номер карты.</td>
    </tr><tr>
        <td>209</td><td>Зарегистрирована похищенная карта, требуется ее изъятие.</td>
    </tr><tr>
        <td>902</td><td>Владелец карты пытается выполнить транзакцию, которая для него не разрешена.</td>
    </tr><tr>
        <td>903</td><td>Предпринята попытка выполнить транзакцию на сумму, превышающую лимит, заданный банком-эмитентом</td>
    </tr><tr>
        <td>904</td><td>Ошибочный формат сообщения с точки зрения банка эмитента.</td>
    </tr><tr>
        <td>907</td><td>Нет связи с банком эмитентом. HOST NOT AVAIL.</td>
    </tr><tr>
        <td>909</td><td>Ошибка функционирования системы, имеющая общий характер. Фиксируется платежной сетью или банком-эмитентом.</td>
    </tr><tr>
        <td>910</td><td>Банк-эмитент недоступен.</td>
    </tr><tr>
        <td>913</td><td>Неправильный формат транзакции с точки зрения сети.</td>
    
    </tr>
</tbody></table>

<p><b>Сооответствие между actionCode и authCode: </b></p>

<table>
    <tbody><tr>
        <th>Значения actionCode <br>(несколько значений перечисляются через запятую)</th>
        <th>Значение authCode</th>
    </tr>
    <tr>
        <td>0</td>
        <td>0</td>
    </tr>
    <tr>
        <td>1,904</td>
        <td>1</td>
    </tr>
    <tr>
        <td>907,910</td>
        <td>2</td>
    </tr>
    <tr>
        <td>103,107</td>
        <td>4</td>
    </tr>
    <tr>
        <td>110,116</td>
        <td>5</td>
    </tr>
    <tr>
        <td>101</td>
        <td>6</td>
    </tr>
    <tr>
        <td>902,913</td>
        <td>7</td>
    </tr>
    <tr>
        <td>903</td>
        <td>8</td>
    </tr>
    <tr>
        <td>106,117,119</td>
        <td>9</td>
    </tr>
    <tr>
        <td>121,123</td>
        <td>10</td>
    </tr>
    <tr>
        <td>203,204,208,209</td>
        <td>11</td>
    </tr>
    <tr>
        <td>100,104,111,125</td>
        <td>12</td>
    </tr>
    <tr>
        <td>109</td>
        <td>13</td>
    </tr>
    <tr>
        <td>Любые другие не указанные выше значения</td>
        <td>2</td>
    </tr>
</tbody></table>

<p><b>Возможные состояния платежа (параметр payment_state):</b></p>

<table>
    <tbody><tr>
        <th>Значение</th>
        <th>Состояние</th>
    </tr>
    <tr>
        <td>payment_approved</td>
        <td>Платеж предавторизован. Состояние означает, что процесс 
предавторизации платежа в Системе РБС прошел успешно. Для данного 
состояния могут 
        быть выполнены команды поставторизации или отмены 
предавторизации платежа.</td>
    </tr>
    <tr>
        <td>payment_deposited</td>
        <td>Платеж поставторизован. Состояние означает, что процесс поставторизации платежа в Системе РБС прошел успешно. 
        Для данного состояния может быть выполнена команда отмены поставторизации платежа.</td>
    </tr>
    <tr>
        <td>payment_declined</td>
        <td>Состояние означает, что процесс предавторизации платежа в Системе РБС был отклонен Банком.</td>
    </tr>
    <tr>
        <td>payment_void</td>
        <td>Состояние означает, что процесс отмены предавторизации платежа в Системе РБС прошел успешно.</td>
    </tr>
    <tr>
        <td>payment_pending</td>
        <td>Состояние означает, что платеж находится в ожидании ответа 
от процессингового центра Банка-экайера. Для данного состояния не может 
быть выполнена никакая команда.</td>
    </tr>
    <tr>
        <td>refunded</td>
        <td>Был произведен возврат денег на карту клиента.</td>
    </tr>
    <tr>
        <td>refund failed</td>
        <td>Была неуспешная попытка возврата денег на карту клиента.</td>
    </tr>
</tbody></table>

<a name="4.6."><h2>4.6. Возврат денег на карту.</h2></a>

<p><i><u>Примечание:</u> По стандартному договору между интернет 
магазином и Альфа Банком возврат денег на карту невозможен. 
При заключении дополнительного соглашения возможен возврат денег на 
карту через web-интерфейс как в личном кабинете, так и HTTPS GET/POST 
командой.</i></p>

<a name="4.6.1."><h3>4.6.1. Инициация возврата денег на карту.</h3></a>

<p>Для возврата денег на карту программное обеспечение Магазина должно сформировать HTTPS GET или POST запрос по адресу:</p>

<pre>https://playground.paymentgate.ru/bpcservlet/Refund
</pre>

<p>Запрос должен содержать параметры</p>

<table>
    <tbody><tr>
        <th>Название параметра</th>
        <th>Тип данных, формат</th>
        <th>Обязательный параметр</th>
        <th>Описание</th>
    </tr>
    <tr>
        <td>MDORDER</td>
        <td>Строка, длиной до 150 символов</td>
        <td></td>
        <td>уникальный идентификатор заказа, полученный при регистрации заказа от системы РБС</td>
    </tr>
    <tr>
        <td>AMOUNT</td>
        <td>Целое число</td>
        <td></td>
        <td>Сумма возврата в копейках</td>
    </tr>
    <tr>
        <td>MERCHANTPASSWD</td>
        <td>Строка длиной до 20 символов</td>
        <td></td>
        <td>пароль Магазина, полученный при регистрации в Системе РБС</td>
    </tr>
    <tr>
        <td>user</td>
        <td>Строка</td>
        <td></td>
        <td>логин дополнительной аутентификации пользователя проводящего возврат</td>
    </tr>
    <tr>
        <td>pwd</td>
        <td>Строка</td>
        <td></td>
        <td>пароль дополнительной аутентификации пользователя проводящего возврат</td>
    </tr>
</tbody></table>

<p>Пример HTTPS GET запроса на операцию "Возврат":</p>

<pre>https://playground.paymentgate.ru/bpcservlet/Refund?MDORDER=-79-31242571-914743124-6-19-12658-412287_p1&amp;AMOUNT=50&amp;MERCHANTPASSWD=lazY2k&amp;user=user1&amp;pwd=qweasd
</pre>

<a name="4.6.2."><h3>4.6.2. Ответ сайта Системы РБС на запрос о возврате денег на карту.</h3></a>

<p>После проведения операции возврата сервер РБС возвращает XML документ с результатами операции возврата.</p>
<p>Пример ответа:</p>

<pre>&lt;?xml version="1.0" encoding="UTF-8"&gt;
    &lt;PSApiResult primaryRC="0" secondaryRC="0"/&gt;
</pre>

<p>XML-тэг <b>PSApiResult</b> содержит в себе кода возврата в виде комбинации <b>PrimaryRC</b> и <b>SecondaryRC</b>.</p>

<table>
    <tbody><tr>
        <th>Параметр</th>
        <th>Тип данных</th>
    </tr>
    <tr>
        <td>primaryRC</td>
        <td>Целое число</td>
    </tr>
    <tr>
        <td>secondaryRC</td>
        <td>Целое число</td>
    </tr>
</tbody></table>

<p>Возможные варианты значений комбинации кодов:</p>

<table>
    <tbody><tr>
        <th>primaryRC</th>
        <th>secondaryRC</th>
        <th>Описание</th>
    </tr>
    <tr>
        <td>0</td>
        <td>0</td>
        <td>платеж успешно прошел</td>
    </tr>
    <tr>
        <td>34</td>
        <td>1014</td>
        <td>платеж не прошел по финансовым причинам</td>
    </tr>
    <tr>
        <td>15</td>
        <td>1018</td>
        <td>нет связи с Банком-эквайером</td>
    </tr>
    <tr>
        <td>15</td>
        <td>1019</td>
        <td>Удалось отправить транзакцию в Банк-эквайер, но ответа не получили</td>
    </tr>
    <tr>
        <td>2</td>
        <td>204</td>
        <td>Заказ с данным MDORDER не найден</td>
    </tr>
</tbody></table>

<a name="4.7."><h2>4.7. Пакетное завершение двухстадийных платежей.</h2></a>

<p>Существует возможность пакетного завершения множества двухстадийных платежей. На странице</p>

<pre>    https://playground.paymentgate.ru/bpcservlet/BPC/batch/batch_deposit_file.jsp
</pre>

<p>расположена форма загрузки файла содержащего список уникальных идентификаторов заказа (MDORDER)</p>
<p>Номер каждого платежа должен быть на новой строчке, через пробел 
после номера можно добавить любую информацию в качестве комментария, 
она отобразится в файле отчета о завершении.</p>
<p>Пример файла со списком платежей на завершение:</p>

<pre>72778945-42-1-65-7108-28842-7372110121_p1
-106-8810753114-31-60-109-52-84-55-79-83-40-73-98_p1 anydesciption
-867123-98123983-87598324-234875-0
</pre>

<p>После нажатия кнопки "Загрузить" начнется фоновый процесс завершения и
 будет сформирован файл отчета о результатах завершения. Файл отчета 
формируется по адресу:</p>

<pre>https://playground.paymentgate.ru/bpcservlet/BPC/batch/upload/pN_ХХХХХХ.out.html
</pre>

<p>где ХХХХХХ - первые шесть символов MERCHANTNUMBER (номера магазина), а
 N - целое число от 1 до 4, т.е. pN может быть p1, p2, p3, p4.</p>
<p>Можно сформировать запрос на пакетное завершение автоматически HTTPS POST запросом следующей формы:</p>

<pre>&lt;input type="text" name="MERCHANTNUMBER" value="XXXXXX"&gt;
&lt;input type="password" name="MERCHANTPASSWORD" value="password"&gt;
&lt;input type="File" name="FILE"&gt;
&lt;input type="checkbox" name="append" value="1" checked&gt;
</pre>

<p>Файл отчета о пакетном завершении один для каждого интернет магазина.
 Параметр append в HTML форме управляет уничтожением старого 
файла отчета. Если append стоит в положении checked, то к старому файлу 
отчетов дописываются новые результаты.</p>

<p>Пример отчета:</p>

<pre>72778945-42-1-65-7108-28842-7372110121_p1 orderNumber=121207014 depositedAmount=100 paymentState=payment_deposited pc=0 sc=0
-106-8810753114-31-60-109-52-84-55-79-83-40-73-98_p1 orderNumber=121207014 depositedAmount=100 paymentState=payment_deposited pc=0 sc=0 batch deposit is finished, input file is deleted=true
</pre>

<a name="4.8."><h2>4.8. Выгрузка отчета о платежах.</h2></a>

<p>Кроме просмотра статистики платежей в личном кабинете магазина на сайте Системы РБС существует
возможность получить статистику в машиночитаемом формате с помощью следующего запроса:</p>

<pre>https://playground.paymentgate.ru/bpcservlet/BPC/batch/batch_query_orders3.jsp?MERCHANTNUMBER=118600118603000118604&amp;MERCHANTPASSWORD=lazY2k&amp;yyyy1=2006&amp;mm1=10&amp;dd1=04&amp;hh1=7&amp;min1=0&amp;yyyy2=2006&amp;mm2=10&amp;dd2=04&amp;hh2=8&amp;min2=0
</pre>

<p>Запрос должен содержать параметры</p>
<table>
    <tbody><tr>
        <th>Название параметра</th>
        <th>Тип данных, формат</th>
        <th>Обязательный параметр</th>
        <th>Описание</th>
    </tr>
    <tr>
        <td>yyyy1</td>
        <td>Четырехзначное целое число</td>
        <td>Да</td>
        <td rowspan="5">Начальная дата отчета, больше или равно.</td>
    </tr>
    <tr>
        <td>mm1</td>
        <td>Целое число от 1 до 12</td>
        <td>Да</td>
    </tr>
    <tr>
        <td>dd1</td>
        <td>Двухзначное целое число от 01 до 31</td>
        <td>Да</td>
    </tr>
    <tr>
        <td>hh1</td>
        <td>Двухзначное целое число от 00 до 23</td>
        <td>Да</td>
    </tr>
    <tr>
        <td>min1</td>
        <td>Двухзначное целое число от 00 до 59</td>
        <td>Да</td>
    </tr>
    <tr>
        <td>yyyy2</td>
        <td>Четырехзначное целое число</td>
        <td>Да</td>
        <td rowspan="5">Конечная дата отчета, меньше или равно.</td>
    </tr>
    <tr>
        <td>mm2</td>
        <td>Двухзначное целое число от 1 до 12</td>
        <td>Да</td>
    </tr>
    <tr>
        <td>dd2</td>
        <td>Двухзначное целое число от 01 до 31</td>
        <td>Да</td>
    </tr>
    <tr>
        <td>hh2</td>
        <td>Двухзначное целое число от 00 до 23</td>
        <td>Да</td>
    </tr>
    <tr>
        <td>min2</td>
        <td>Двухзначное целое число от 00 до 59</td>
        <td>Да</td>
    </tr>
    <tr>
        <td>MERCHANTNUMBER</td>
        <td>Строка</td>
        <td>Да</td>
        <td>Уникальный идентификатор Магазина, полученный при регистрации в Системе РБС</td>
    </tr>
    <tr>
        <td>MERCHANTPASSWORD</td>
        <td>Строка</td>
        <td>Да</td>
        <td>Пароль Магазина, полученный при регистрации в Системе РБС</td>
    </tr>
</tbody></table>

<p>Отчет представляет собой текстовой файл, каждый платеж на отдельной строчке, значения в строчке
отделены символом табуляции. <br><i><u>Примечание</u>: За Один раз можно выгрузить не более 200 строк.</i></p>

<p>Формат строки отчета:</p>

<table>
    <tbody><tr>
        <th>Название колонки</th>
        <th>Тип данных, формат, регистр</th>
        <th>Описание</th>
    </tr>
    <tr>
        <td>MDORDER</td>
        <td>Строка, длиной до 150 символов</td>
        <td>Уникальный идентификатор заказа, полученный при регистрации заказа от Системы РБС.</td>
    </tr>
    <tr>
        <td>order number</td>
        <td></td>
        <td>Внутренний идентификационный номер заказа в информационной системе сайта Магазина.</td>
    </tr>
    <tr>
        <td>payment amount</td>
        <td>Целое десятичное число.</td>
        <td>Значение запрошенной суммы платежа. <br>Значение указано в копейках. <br>Например, 4378, что соответствует сумме 43 рубля 78 копеек.</td>
    </tr>
    <tr>
        <td>approved amount</td>
        <td>Целое десятичное число.</td>
        <td>Значение суммы заблокированной на карте клиента. <br>Значение указано в копейках. <br>Например, 4378, что соответствует сумме 43 рубля 78 копеек.</td>
    </tr>
    <tr>
        <td>deposited amount</td>
        <td>Целое десятичное число.</td>
        <td>Значение суммы переведенной на счет Магазина с карты клиента. <br>Значение указано в копейках. <br>Например, 4378, что соответствует сумме 43 рубля 78 копеек.</td>
    </tr>
    <tr>
        <td>card number (PAN)</td>
        <td></td>
        <td>Маскированный номер карты клиента.</td>
    </tr>
    <tr>
        <td>cardholder name</td>
        <td></td>
        <td>Имя владельца карты.</td>
    </tr>
    <tr>
        <td>primaryRC и secondaryRC</td>
        <td>Пример 0-0 или 34-1014</td>
        <td>primary code and secondary code</td>
    </tr>
    <tr>
        <td>payment date</td>
        <td>Дата-Время</td>
        <td><a href="http://www.w3.org/TR/xmlschema-2/#isoformats">http://www.w3.org/TR/xmlschema-2/#isoformats</a></td>
    </tr>
</tbody></table>

<a name="4.9."><h2>4.9. Выгрузка отчета о платежах за целый день в TSV или Excel формате.</h2></a>

<p>Делается запросом:</p> 

<pre>https://playground.paymentgate.ru/bpcservlet/BPC/batch/day.jsp?MERCHANTNUMBER=121089121090000121091&amp;MERCHANTPASSWD=4rfvbnm&amp;DATE=YYYYMMDD&amp;MODE=XML
</pre>

<p>Если параметр MODE отсутствует, то файл будет TSV c полями</p>

<pre> 
&lt;%=orderNumber%&gt;&lt;%=pan%&gt;&lt;%=sDate%&gt;&lt;%=amount%&gt;&lt;%=approvedAmount%&gt;&lt;%=depositedAmount%&gt;&lt;%=text%&gt;&lt;%=actionCode%&gt;(&lt;%=sActionCode
описание человеческое%&gt;)&lt;%=pc%&gt;&lt;%=sc%&gt;&lt;%=paymentState%&gt;&lt;%=информация_о_банке эмитенте%&gt;
</pre>

<p>Если MODE=XML, то генерируется XML, совместимый с Microsoft Excel.</p>

<a name="4.10."><h2>4.10. Использование механизма аутентификации 3D-Secure/SecureCode при приеме платежей на стороне магазина.</h2></a>
<p>
<font size="6" color="red">Не надо читать этот пункт, если данные карты вводятся на стороне РБС</font>
</p><p>

</p><p>В случае, когда для пластиковой карты Банком-эмитентом включен механизм аутентификации по протоколам 3D-Secure/SecureCode,
сервер Системы РБС в ответ на запрос Магазина возвращает Магазину строку, содержащую параметры MDORDER, ACSUrl и PaReq.</p>
<p>Данная строка представляет собой набор из трех пар (ключ=значение) объединенных знаком &amp;</p>

<table>
    <tbody><tr>
        <th>Название параметра</th>
        <th>Тип данных, формат</th>
        <th>Описание</th>
    </tr>
    <tr>
        <td>MDORDER</td>
        <td>Строка до 150 символов</td>
        <td>Уникальный идентификатор заказа, полученный при регистрации заказа от Системы РБС.</td>
    </tr>
    <tr>
        <td>ACSUrl</td>
        <td>URL</td>
        <td>Ссылка на страницу сайта Банка-Эмитента, созданная банком 
для авторизации владельца карты. Кодируется в соответствии как значение 
URL (URI-encoded)</td>
    </tr>
    <tr>
        <td>PaReq</td>
        <td>Строка</td>
        <td>Упакованное с помощью алгоритма BASE64 значение запроса аутентификации покупки</td>
    </tr>
</tbody></table>

<p>Пример строки:</p>

<pre>MDORDER=-80-38-40-8267-123-6984-28-116-6837587031-20_p1&amp;ACSUrl=https://playground.paymentgate.ru/acs/PAReq&amp;PaReq=BASE64_encoded_data
</pre>

<p>Для осуществления аутентификации на стороне банка-эмитента владелец 
карты, использующий 3D-Secure, должен быть перенаправлен на сервер 
аутентификации банка-эмитента. Для этого сайт Магазина должен создать 
HTML-форму с командой переадресации и показать в браузере владельца 
карты.</p>

<p>Пример формы:</p>

<pre>&lt;html&gt;
&lt;body OnLoad=OnLoadEvent();&gt;
    &lt;form name="downloadForm" action="<b>ACSUrl_value</b>" method="POST"&gt; 
        &lt;input type="hidden" name="PaReq" value="<b>PaReq_value</b>"&gt;
        &lt;input type="hidden" name="TermUrl" value="<b>BackURL_value</b>"&gt;
        &lt;input type="hidden" name="MD" value="<b>MDORDER_value</b>"&gt;
    &lt;/form&gt;
    &lt;script language="Javascript"&gt;
        document.downloadForm.submit();
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>

<p>Значения полей формы:</p>

<table>
    <tbody><tr>
        <th>Название параметра</th>
        <th>Тип данных, формат</th>
        <th>Описание</th>
    </tr>
    <tr>
        <td>PaReq</td>
        <td>Строка</td>
        <td>PaReq, полученный от системы РБС, т.е. упакованное с помощью алгоритма BASE64 значение запроса аутентификации покупки.</td>
    </tr>
    <tr>
        <td>TermUrl</td>
        <td>URL</td>
        <td>BackURL, ссылка для возврата на страницу сайта Магазина, созданная магазином. Кодируется как значение URL (URI-encoded)</td>
    </tr>
    <tr>
        <td>MD</td>
        <td>Строка до 150 символов</td>
        <td>Уникальный идентификатор заказа, полученный при регистрации заказа от Системы РБС.</td>
    </tr>
</tbody></table>

<p>После окончания процесса аутентификации на стороне банка-эмитента, 
браузер владельца карты переадресуется обратно на сайт Магазина по 
ссылке 
указанной в параметре <b>TermURL</b> в выше описанной HTML-форме.</p>

<p>Переадресация обратно содержит в себе следующие параметры:</p>

<table>
    <tbody><tr>
        <th>Название параметра</th>
        <th>Тип данных, формат</th>
        <th>Описание</th>
    </tr>
    <tr>
        <td>MD</td>
        <td>Строка до 150 символов</td>
        <td>значение MDORDER, т.е. уникальный идентификатор заказа, полученный при регистрации заказа от Системы РБС.</td>
    </tr>
    <tr>
        <td>PaRes</td>
        <td>&nbsp;</td>
        <td>результат аутентификации покупателя банком-эмитентом, BASE64 закодированная строка</td>
    </tr>
</tbody></table>

<p>Далее сайт Магазина должен переслать полученные от банка-эмитента 
параметры системе РБС, отправив для этого HTTPS запрос на сервер РБС в 
следующем формате:</p>

<pre>https://playground.paymentgate.ru/bpcservlet/BPC3DS?MD=mdorde_value&amp;PaRes=PaRes_value
</pre>

<p><i><u>Примечание</u>: регистр символов в имени параметра PaRes имеет значение.</i></p>
<p>Ответ на вышеописанный запрос представляется в такой же форме как и платеж без участия 3D-Secure/SecureCode 
(см. <a href="#4.1.1.6.">конец пункта 4.1.1.6</a>)</p>


<!-- END of overall table--->        

<div id="fixme" style="background-color:#fff;text-align:center;">
<input id="but1" value="Oглавление" onclick="svernut();" type="Button">
<br>
<h4>Содерждание:</h4>
<table>
<tbody><tr><td>1.</td><td><a href="#1.">Основные термины и определения.</a></td></tr>
<tr><td>2.</td><td><a href="#2.">Возможности Системы РБС.</a></td></tr>
<tr><td>2.1.</td><td><a href="#2.1.">Поддерживаемые платежи и механизмы аутентификации.</a></td></tr>
<tr><td>2.2.</td><td><a href="#2.2.">Функциональные возможности системы.</a></td></tr>
<tr><td>2.3.</td><td><a href="#2.3.">Страница оплаты.</a></td></tr>
<tr><td>3.</td><td><a href="#3.">Описание процессов приема платежей.</a></td></tr>
<tr><td>3.1.</td><td><a href="#3.1.">Примем платежа на стороне Системы РБС.</a></td></tr>
<tr><td>3.2.</td><td><a href="#3.2.">Взаимодействие при размещении страницы оплаты на стороне Магазина.</a></td></tr>
<tr><td>3.3.</td><td><a href="#3.3.">Прием платежа для карты 3D-Secure/SecureCode на стороне магазина.</a></td></tr>
<tr><td>4.</td><td><a href="#4.">Техническое описание функциональных возможностей Системы РБС.</a></td></tr>
<tr><td>4.1.</td><td><a href="#4.1.">Прием одностадийного или двухстадийного платежа.</a></td></tr>
<tr><td>4.1.1.</td><td><a href="#4.1.1.">Регистрация заказа (одностадийный или двухстадийный платеж).</a></td></tr>
<tr><td>4.1.1.1.</td><td><a href="#4.1.1.1.">Запрос на регистрацию заказа (одностадийный или двухстадийный платеж).</a></td></tr>
<tr><td>4.1.1.2.</td><td><a href="#4.1.1.2.">Ответ в формате HTML сервера Системы РБС на запрос о регистрации заказа.</a></td></tr>
<tr><td>4.1.1.3.</td><td><a href="#4.1.1.3.">Ответ в формате XML сервера Системы РБС на запрос о регистрации заказа.</a></td></tr>
<tr><td>4.1.1.4.</td><td><a href="#4.1.1.4.">Ответ текстовом формате сервера Системы РБС на запрос о регистрации заказа.</a></td></tr>
<tr><td>4.1.1.5.</td><td><a href="#4.1.1.5.">Ответ в случае ошибки регистрации заказа.</a></td></tr>
<tr><td>4.1.1.6.</td><td><a href="#4.1.1.6.">Ответ на запрос платежа с данными карты собранными на стороне Магазина.</a></td></tr>
<tr><td>4.1.2.</td><td><a href="#4.1.2.">Подробное описание оплаты заказа (одностадийный или двухстадийный платеж).</a></td></tr>
<tr><td>4.1.2.1.</td><td><a href="#4.1.2.1.">Порядок проведения оплаты.</a></td></tr>
<tr><td>4.1.2.2.</td><td><a href="#4.1.2.2.">Возврат Клиента обратно на 
Сайт Магазина с одновременной передачей информации с результатами оплаты
 от Системы РБС обратно Магазину.</a></td></tr>
<tr><td>4.2.</td><td><a href="#4.2.">Завершение двухстадийного платежа. (Проведение отложенной авторизации).</a></td></tr>
<tr><td>4.2.1.</td><td><a href="#4.2.1.">Инициация Завершения двухстадийного платежа.</a></td></tr>
<tr><td>4.2.2.</td><td><a href="#4.2.2.">Ответ сайта Системы РБС на завершение двухстадийного платежа.</a></td></tr>
<tr><td>4.3.</td><td><a href="#4.3.">Отмена отложенной авторизации двухстадийного платежа. Снятие блокировки средств на счету клиента.</a></td></tr>
<tr><td>4.3.1.</td><td><a href="#4.3.1.">Инициация Снятие блокировки средств на счету клиента.</a></td></tr>
<tr><td>4.3.2.</td><td><a href="#4.3.2.">Ответ сайта Системы РБС на запрос о Снятии блокировки средств на счету клиента.</a></td></tr>
<tr><td>4.3.3.</td><td><a href="#4.3.3.">Ответ сайта Системы РБС на некорректный запрос о Снятии блокировки средств на счету клиента или завершении платежа.</a></td></tr>
<tr><td>4.4.</td><td><a href="#4.4.">Отмена одностадийного платежа.</a></td></tr>
<tr><td>4.4.1.</td><td><a href="#4.4.1.">Инициация отмены одностадийного платежа.</a></td></tr>
<tr><td>4.4.2.</td><td><a href="#4.4.2.">Ответ сайта Системы РБС на запрос об отмене одностадийного платежа.</a></td></tr>
<tr><td>4.5.</td><td><a href="#4.5.">Запрос состояния платежа.</a></td></tr>
<tr><td>4.6.</td><td><a href="#4.6.">Возврат денег на карту.</a></td></tr>
<tr><td>4.6.1.</td><td><a href="#4.6.1.">Инициация возврата денег на карту.</a></td></tr>
<tr><td>4.6.2.</td><td><a href="#4.6.2.">Ответ сайта Системы РБС на запрос о возврате денег на карту.</a></td></tr>
<tr><td>4.7.</td><td><a href="#4.7.">Пакетное завершение двухстадийных платежей.</a></td></tr>
<tr><td>4.8.</td><td><a href="#4.8.">Выгрузка отчета о платежах.</a></td></tr>
<tr><td>4.9.</td><td><a href="#4.9.">Выгрузка отчета о платежах за целый день в TSV или Excel формате.</a></td></tr>
<tr><td>4.10.</td><td><a href="#4.10.">Использование механизма аутентификации 3D-Secure/SecureCode при приеме платежей на стороне магазина.</a></td></tr>
</tbody></table>
    

</div>


</i></div></body></html>